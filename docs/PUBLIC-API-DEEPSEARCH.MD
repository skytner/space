Архитектурный анализ и сравнительное исследование публичных интерфейсов прикладного программирования для интеграции астрометрических данных в веб-приложенияСовременная астрономия переживает эпоху «больших данных», когда объемы информации, генерируемые космическими миссиями и наземными обзорами неба, исчисляются петабайтами. Для разработчиков веб-приложений и интерактивных карт звездного неба это создает уникальный вызов: как обеспечить доступ к точным координатам, яркости и характеристикам миллиардов небесных объектов в условиях ограничений браузерной среды, таких как задержки сети, политика безопасности (CORS) и ограниченные вычислительные ресурсы клиента. Переход от локальных статических каталогов к сервис-ориентированной архитектуре в рамках концепции Виртуальной обсерватории (IVOA) позволил стандартизировать доступ к данным через специализированные протоколы, такие как Table Access Protocol (TAP), однако их использование требует глубокого понимания специфики астрометрических форматов и методов фильтрации данных на стороне сервера.В данном отчете представлен детальный анализ существующих публичных API и наборов данных, пригодных для реализации интерактивных звездных карт. Исследование охватывает как фундаментальные академические архивы (ESA, NASA, CDS), так и коммерческие решения, ориентированные на разработчиков, с акцентом на типы доступа, форматы данных, ограничения и практическую применимость в современных веб-стеках.Экосистема данных Виртуальной обсерватории: протоколы TAP и ADQLФундаментом для большинства профессиональных астрономических сервисов является протокол доступа к таблицам (Table Access Protocol — TAP). В отличие от классических REST API, возвращающих фиксированные наборы полей, TAP предоставляет интерфейс для выполнения запросов на языке ADQL (Astronomical Data Query Language), который является расширенным подмножеством SQL. Это позволяет разработчику выполнять сложные геометрические операции, такие как поиск в конусе (cone search) или пересечение областей, непосредственно на стороне сервера базы данных, минимизируя объем передаваемого трафика.Архитектура доступа через TAPПротокол TAP поддерживает два режима выполнения запросов, которые критически важны для проектирования бэкенда веб-приложения. Синхронный режим (/sync) предназначен для быстрых запросов, возвращающих небольшие наборы данных (обычно до нескольких тысяч строк) в течение короткого времени ожидания HTTP-соединения. Асинхронный режим (/async) используется для масштабных выборок, когда сервер создает задачу (job), выполняет её в фоновом режиме и предоставляет URL для загрузки результата после завершения.ХарактеристикаСинхронный режим (Sync)Асинхронный режим (Async)Время ответаНемедленно (обычно < 60-90 сек) Отложено (минуты/часы) Лимиты строкОбычно жестко ограничены (например, 2000 для Gaia) Почти не ограничены (до миллионов строк) ИспользованиеЖивой поиск, обновление текущего вьюпорта картыПервоначальная загрузка тайлов или больших секторовФорматыVOTable, JSON, CSV, FITS VOTable, JSON, CSV, FITS Для веб-приложения на языке JavaScript использование TAP требует формирования POST-запросов с телом ADQL. Примером может служить запрос к базе Gaia для получения звезд в определенном радиусе:$$\text{SELECT source\_id, ra, dec, phot\_g\_mean\_mag FROM gaiadr3.gaia\_source WHERE 1=CONTAINS(POINT('ICRS', ra, dec), CIRCLE('ICRS', 120.5, -20.1, 0.5))}$$Этот запрос эффективно выбирает только те объекты, которые попадают в круг радиусом 0.5 градуса вокруг заданных координат.Репозитории институционального уровня: ESA Gaia и архивы NASAНаиболее достоверные и глубокие данные о звездах предоставляются космическими агентствами. Эти данные являются результатом многолетних миссий по картированию неба и обладают высочайшей точностью.Миссия Gaia (ESA): Золотой стандарт астрометрииАрхив Gaia (European Space Agency) является основным источником данных для любой современной звездной карты. Третий релиз данных (DR3) содержит информацию о более чем 1.8 миллиарда звезд, включая их положение, параллакс (расстояние), собственные движения и фотометрию в нескольких диапазонах.Параметр доступаОписаниеНазваниеESA Gaia Archive Тип APITAP / TAP+ (REST-интерфейс на базе HTTP) Форматы данныхVOTable, FITS, CSV, JSON УсловияБесплатно, анонимный доступ (с лимитами) или регистрация CORSПрямые вызовы из браузера часто блокируются; требуется прокси-сервер Преимуществом Gaia является наличие таблицы gaia_source, которая объединяет основные параметры объектов. Для веб-приложений особенно полезны предварительно вычисленные кросс-матчи с другими каталогами (2MASS, Hipparcos), что позволяет обогащать карту данными из разных источников без необходимости проводить сложные геометрические сопоставления на клиенте. Однако объем данных Gaia таков, что загрузка всего каталога невозможна; приложение должно динамически запрашивать данные только для текущей области видимости пользователя.Архивы NASA: MAST, HEASARC и HorizonsNASA предоставляет доступ к данным через несколько специализированных центров. Архивы MAST (Mikulski Archive for Space Telescopes) хранят данные миссий Hubble, Kepler, TESS и JWST. Доступ к ним осуществляется через MAST API, который поддерживает как REST, так и TAP.Для отображения объектов Солнечной системы (планет, Луны, астероидов) критически важным является сервис JPL Horizons. В отличие от звезд, положение которых почти статично, координаты планет меняются ежеминутно. API Horizons позволяет получать эфемериды в формате JSON, что идеально подходит для интеграции в веб-интерфейсы.Сервис NASAТип данныхФормат / Протоколapi.nasa.govAPOD, NeoWs (астероиды), погода REST / JSON (требуется ключ) JPL HorizonsПланеты, спутники, астероиды REST (GET/POST) / JSON / Text HEASARCРентгеновские и гамма-источники Xamin API / TAP / FITS / JSON MASTЗвезды (Kepler/TESS), галактики (Hubble) Astroquery / TAP / JSON Особого внимания заслуживает API NeoWs (Near Earth Object Web Service), который предоставляет актуальные данные о сближающихся с Землей астероидах, включая их размеры и расчетные траектории. Для интерактивной карты это может служить динамическим слоем «событий» в реальном времени.Сервисы CDS: SIMBAD и VizieRСтрасбургский центр астрономических данных (CDS) является узловым пунктом, объединяющим тысячи различных каталогов. Их сервисы позволяют не только получать координаты, но и разрешать названия объектов (name resolution).SIMBAD: Идентификация и типы объектовSIMBAD — это реляционная база данных, содержащая более 11 миллионов объектов. Она незаменима, если пользователю нужно найти объект по имени (например, «Вега» или «M31»). Сервис Sesame (часть экосистемы CDS) позволяет отправить имя объекта и получить его координаты в формате XML или JSON.ОсобенностьЗначениеОсновная функцияИдентификация объектов и поиск по именам ДоступTAP, скриптовый интерфейс, Sesame Лимиты5-10 запросов в секунду; при превышении — временный бан IP Типы данныхЗвезды, галактики, туманности, библиография Для веб-карты SIMBAD предоставляет иерархию типов объектов (otype), что позволяет визуализировать различные классы звезд (белые карлики, красные гиганты) разными иконками или цветами.VizieR: Библиотека каталоговЕсли Gaia — это один огромный массив данных, то VizieR — это агрегатор более чем 20 000 опубликованных каталогов. Через VizieR можно получить доступ к таким классическим наборам, как:Hipparcos (I/239): 118 000 звезд высокой точности (база для многих карт).Yale Bright Star Catalog (V/50): Звезды, видимые невооруженным глазом.Tycho-2 (I/259): 2.5 миллиона ярчайших звезд неба.VizieR поддерживает вывод в форматах TSV, VOTable и JSON через утилиту vizquery или TAP-сервер. Однако стоит учитывать, что структура таблиц в VizieR сильно варьируется от каталога к каталогу, что усложняет написание универсального парсера на стороне фронтенда.Коммерческие и дружественные к разработчикам APIПрофессиональные астрономические архивы часто имеют высокий порог входа и специфические методы аутентификации. В последние годы появились сервисы, предлагающие более привычные веб-разработчикам интерфейсы.AstronomyAPI.comAstronomyAPI является одним из немногих коммерческих решений, предоставляющих готовые эндпоинты для генерации звездных карт и получения данных о небесных телах через стандартный REST/JSON.КритерийХарактеристикаТип доступаREST API с Basic Authentication АутентификацияApplication ID и Secret (Base64 кодирование) CORSПоддерживается через настройку разрешенных доменов (Origins) в панели управления ВозможностиЗвездные карты (изображения), поиск объектов, фазы Луны ОграниченияБесплатный план ограничен (например, 100 запросов в день); платные планы для высоких нагрузок Важной особенностью AstronomyAPI является поддержка CORS. В отличие от Gaia или SIMBAD, этот сервис позволяет выполнять запросы напрямую из браузерного JavaScript, если домен приложения указан в настройках API-ключа. Это значительно упрощает архитектуру приложения, избавляя от необходимости развертывания промежуточного бэкенда.Прочие специализированные сервисыСуществует ряд API, сфокусированных на конкретных задачах:IP Geolocation Astronomy API: Предоставляет время восхода/захода Солнца и Луны, азимут и высоту светил на основе IP-адреса или координат пользователя.TimeAndDate API: Коммерческий сервис с высокой точностью расчета астрономических событий и положений планет.Astrometry.net API: Позволяет отправить изображение звездного неба и получить в ответ распознанные координаты центра снимка и список видимых на нем объектов (plate solving).Файловые датасеты и оптимизация для фронтендаДля высокопроизводительных интерактивных карт, работающих со скоростью 60 кадров в секунду, сетевые запросы при каждом движении мыши недопустимы. В таких случаях оправдано использование предварительно обработанных файловых датасетов.GeoJSON и статические наборы данныхРепозиторий celestial_data (и проект d3-celestial) предлагают оптимизированные наборы данных в формате GeoJSON. Этот формат нативно поддерживается библиотеками визуализации, такими как D3.js, Leaflet или OpenLayers.Набор данныхОписаниеКол-во объектовstars.6.min.jsonЗвезды до 6-й величины (видимые глазом) ~5,000stars.8.min.jsonЗвезды до 8-й величины (бинокль) ~40,000constellations.jsonГраницы и линии созвездий 88 созвездийmw.jsonОчертания Млечного Пути ПолигоныИспользование таких файлов позволяет загрузить основные элементы карты один раз и выполнять проекцию координат (из сферических RA/Dec в экранные x/y) на стороне клиента. Все данные в этих наборах приведены к эпохе J2000 и системе координат WGS84, что упрощает их использование с картографическими движками.Форматы Stellarium и NOMADStellarium, популярный планетарий с открытым кодом, использует собственные бинарные форматы для хранения сотен миллионов звезд (каталог NOMAD и другие). Хотя эти файлы не предназначены для прямого использования в веб-приложениях из-за сложности парсинга зонной структуры, разработчики могут извлекать из них данные для создания собственных тайловых серверов. Для веб-приложения Stellarium также предлагает плагин RemoteControl, который поднимает локальный HTTP-сервер с API, возвращающим данные об объектах в формате JSON.Сводная таблица API и источников данныхДля принятия решения о выборе источника данных ниже приведена консолидированная таблица параметров.Название ресурсаСсылка / ДокументацияТип API / ДоступФормат данныхОграничения и лимитыПлюсы / Минусы для WebESA Gaiagea.esac.esa.int TAP / TAP+ (REST) VOTable, JSON, CSV 2k строк (sync), регистрация для async (+) Огромная точность. (-) Нет CORS, сложный ADQL.CDS SIMBADsimbad.u-strasbg.fr TAP / Sesame JSON, XML, VOTable 5-10 запросов/сек (+) Поиск по именам. (-) Строгие лимиты частоты.AstronomyAPIastronomyapi.com REST JSON, Images 100 зап/день (free) (+) Есть CORS, простая авторизация. (-) Платно для нагрузок.JPL Horizonsssd.jpl.nasa.gov REST / Batch JSON, Text 300 сек таймаут (+) Данные планет. (-) Требует парсинга текстовых ответов.VizieRvizier.u-strasbg.fr TAP / vizquery JSON, CSV, FITS Зависит от каталога(+) Доступ ко всем каталогам. (-) Гетерогенная структура.NASA NeoWsapi.nasa.gov REST JSON 1000 зап/час (с ключом) (+) Актуальные астероиды. (-) Узкая специализация.Astrometry.netnova.astrometry.net REST JSON Нужен API-ключ (+) Распознавание фото. (-) Не для отрисовки карты.Celestial Datadieghernan.github.io/celestial_data Статические файлы GeoJSON Нет (Open Source) (+) Макс. скорость на клиенте. (-) Статичные данные.Технические аспекты реализации: CORS и геометрические проекцииОдной из главных преград при создании веб-приложения является отсутствие поддержки Cross-Origin Resource Sharing (CORS) в большинстве академических сервисов. Браузер блокирует запросы к gea.esac.esa.int или simbad.u-strasbg.fr, если они инициированы скриптом с другого домена.Стратегия бэкенд-проксированияЕдинственным надежным решением для использования данных Gaia или SIMBAD в продакшене является развертывание собственного прокси-сервера (например, на Node.js, Python или Go).Запрос клиента: Фронтенд отправляет запрос к вашему API: GET /api/stars?ra=120&dec=20&radius=1.Обработка на сервере: Бэкенд формирует ADQL-запрос и отправляет его к Gaia через TAP.Кеширование: Бэкенд может закешировать результат (например, в Redis), чтобы не перегружать академические серверы и ускорить повторные запросы.Трансформация: Сервер преобразует громоздкий VOTable в компактный JSON и добавляет заголовок Access-Control-Allow-Origin: *.Геометрические вычисленияОтображение звезд на плоскости экрана требует пересчета координат. Небесные координаты $(RA, Dec)$ — это сферическая система. Для интерактивной карты наиболее часто используются следующие проекции:Стереографическая (Stereographic): Сохраняет углы, идеальна для отображения небольших участков неба (эффект «взгляда в телескоп»).Аитов (Aitoff) или Мольвейде (Mollweide): Используются для отображения всей небесной сферы в виде эллипса.Гномоническая (Gnomonic): Отображает большие круги (например, метеоры) в виде прямых линий.Для расчета текущего положения объектов относительно наблюдателя на Земле (азимут и высота) необходимо учитывать местное звездное время (LST) и географические координаты пользователя. Эти расчеты лучше выполнять на клиенте, используя библиотеки типа astronomy-bundle или astronomia, чтобы обеспечить плавность анимации при вращении Земли.Рекомендации по выбору архитектуры для «Звездной карты»Исходя из анализа, для сценария «интерактивная карта со звездами в браузере» предлагаются следующие варианты архитектуры:Рекомендация 1: Гибридный подход (Статика + Динамика) — Оптимально для большинства задачДля обеспечения максимальной производительности и полноты данных рекомендуется использовать комбинацию статических файлов и бэкенд-прокси.Базовый слой: Загрузите звезды до 8-й величины из celestial_data (GeoJSON). Это покроет 99% потребностей пользователя при общем обзоре неба без задержек сети.Динамический слой (Бэкенд-прокси): При сильном зуме или поиске конкретных объектов делайте запросы к собственному серверу, который проксирует запросы к Gaia DR3 (для звезд) и JPL Horizons (для планет).Идентификация: Используйте SIMBAD Sesame через прокси для поиска объектов по именам.Рекомендация 2: Легкий фронтенд через AstronomyAPI — Для быстрого стартаЕсли разработка собственного бэкенда нецелесообразна, используйте AstronomyAPI.com.Реализация: Прямые вызовы из браузера (после настройки CORS в панели управления API).Функционал: Получение данных о положении планет, фазах Луны и генерация готовых SVG/PNG карт для конкретных дат и локаций.Ограничения: Учитывайте лимиты запросов и потенциальную стоимость при масштабировании.Рекомендация 3: Профессиональный инструмент на базе TAP/ADQLДля приложений, требующих глубокого анализа (например, фильтрация звезд по спектральному классу или расстоянию), необходимо строить архитектуру вокруг TAP-сервисов.Реализация: Полная интеграция с ESA Gaia и VizieR через асинхронные запросы.Особенности: Ваше приложение должно уметь обрабатывать формат VOTable (используя библиотеку votablejs или аналоги) и управлять жизненным циклом серверных задач (jobs).Визуализация: Использование WebGL (через Three.js или PixiJS) для отрисовки сотен тысяч звездных точек, полученных из Gaia, с сохранением высокой частоты кадров.Выбор конкретного пути зависит от целевой аудитории: для образовательного проекта достаточно статических GeoJSON-файлов, тогда как для инструмента астронома-любителя потребуется живая интеграция с архивами ESA и NASA через защищенный бэкенд-слой. В любом случае, соблюдение этикета использования публичных ресурсов (кеширование, ограничение частоты запросов) является обязательным условием для обеспечения стабильной работы приложения.

---

## Что нужно фронту (контракт для MSW и бэкенда)

Фронт **не знает** про TAP, Gaia, VOTable, CORS. Он знает только **свой API** — эндпоинты и форматы ответов. Сначала описываем модели и этот контракт, делаем MSW под него, потом поднимаем бэк с теми же контрактами.

### Эндпоинты и контракт (единый для MSW и apps/api)

| Метод | Эндпоинт | Назначение |
|-------|----------|------------|
| GET | `/api/celestial` или `/api/stars` | Список объектов в области (по viewport или ra/dec/radius). |
| GET | `/api/celestial/:id` или `/api/stars/:id` | Один объект по id (карточка, детали). |
| GET | `/api/celestial/search?q=...` | Поиск по имени (позже, через прокси к SIMBAD Sesame). |

Опционально для статики:

| Метод | Эндпоинт | Назначение |
|-------|----------|------------|
| GET | `/api/celestial/static` или отдача файла из `public/` | Базовый слой звёзд (GeoJSON до 6–8 mag) — один раз загрузили, без запросов при pan. |

### Формат ответа (DTO), общий для всех типов объектов

- **Список (GET /api/celestial):**  
  `{ "items": [ { "id", "type", "ra", "dec", "name", "magnitude?", "description?" } ], "meta"?: {} }`  
  Поля: `id` (string), `type` (star | planet | galaxy | comet | asteroid | pulsar | blackHole), `ra`, `dec` (числа, градусы), `name`, опционально `magnitude`, `description`. В packages (api-contracts) — тип `CelestialItem`, `CelestialType`.

- **Один объект (GET /api/celestial/:id):**  
  Тот же объект в виде одного объекта (тот же DTO без обёртки `items`).

- **Координаты:** на фронте для карты можно использовать `ra`/`dec` как «мировые» и переводить в экранные через `worldToScreen` (см. MAP-DESIGN). Бэк отдаёт только ra/dec (или единый `position: { ra, dec }`), без экранных пикселей.

### Что делать по шагам

1. **Пакеты (api-contracts):** типы `CelestialType`, `CelestialItem`, ответ списка `{ items: CelestialItem[] }`, ответ одного объекта. Общие типы там же при необходимости.
2. **Модуль celestial (или map) на фронте:** api-клиент (функции `getCelestialList(params)`, `getCelestialById(id)`), вызывают `fetch` к вашему API (baseUrl из env). Моки в `modules/celestial/api/mocks/` (или `modules/map/api/mocks/`): MSW handlers на `GET /api/celestial`, `GET /api/celestial/:id` с фикстурами под эти DTO.
3. **Фронт:** рисует карту, запрашивает список по текущему viewport (или ra/dec/radius), отображает маркеры по типам, клик → запрос по id → карточка. Всё на контракте выше.
4. **Бэк (позже):** эндпоинты с теми же путями и форматами ответов; внутри — моки, статика из файла или прокси к Gaia/TAP. Фронт только меняет baseUrl (или не меняет, если с того же origin).

Итого: фронту нужны **только эти эндпоинты и DTO**. Модели в packages, MSW под них, потом бэк под тот же контракт.